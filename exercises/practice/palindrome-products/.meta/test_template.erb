require 'minitest/autorun'
require_relative 'palindrome_products'

class PalindromesTest < Minitest::Test
<% json["cases"].each do |cases| %>
    def test_<%= underscore(cases["description"]) %>
        <%= skip? %>
        <%- if cases["expected"].is_a?(Hash) && cases["expected"].key?("error") -%>
            error = assert_raises(ArgumentError) do
                palindromes = Palindromes.new(max_factor: <%= cases["input"]["max"] %> <%= cases["input"]["min"] != 1 ?  ", min_factor: #{cases["input"]["min"]}" : "" %>)
                palindromes.generate
                palindromes.<%= cases["property"] %>
            end
            assert_equal "<%= cases["expected"]["error"]%>", error.message
        <%- else -%>
                palindromes = Palindromes.new(max_factor: <%= cases["input"]["max"] %> <%= cases["input"]["min"] != 1 ?  ", min_factor: #{cases["input"]["min"]}" : "" %>)
                palindromes.generate
                <%= cases["property"] %> = palindromes.<%= cases["property"] %>
                assert_equal <%= cases["expected"]["value"] || "nil" %>, <%= cases["property"] %>.value
                assert_<%= cases["expected"]["factors"].size > 1 ? "includes" : "equal" %> <%= cases["expected"]["factors"].size > 1 ? cases["expected"]["factors"].permutation(2).to_a : cases["expected"]["factors"] %>, <%= cases["property"] %>.factors
        <%- end -%>
    end
<% end %>
end
