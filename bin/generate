#!/usr/bin/env ruby

require_relative '../lib/helper'
require 'generator'

configletPath = "#{EXERCISM_RUBY_ROOT}/bin/configlet"
unless File.file?(configletPath)
  raise Exception.new("Unable to find configlet, fetch using bin/fetch_configlet")
end

paths = Generator::Paths.new(track: EXERCISM_RUBY_ROOT, metadata: METADATA_REPOSITORY_PATH)

generators = Generator::CommandLine.new(paths).parse(ARGV)
exit 1 unless generators

generators.each do |generator|
  # Generate tests
  generator.call

  # Generate READMEs
  system("#{configletPath} generate #{EXERCISM_RUBY_ROOT} --only=#{generator.exercise.slug}")
end
